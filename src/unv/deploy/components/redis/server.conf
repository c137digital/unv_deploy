# 1k => 1000 bytes
# 1kb => 1024 bytes
# 1m => 1000000 bytes
# 1mb => 1024*1024 bytes
# 1g => 1000000000 bytes
# 1gb => 1024*1024*1024 bytes

# include /path/to/other.conf
# loadmodule /path/to/my_module.so

dir {{ deploy.data_dir }} # data.rdb

bind {{ deploy.public_ip }}
port {{ deploy.port }}
protected-mode no

# /proc/sys/net/core/somaxconn to 5000
tcp-backlog {{ deploy.tcp_connection_count }} # 5000
timeout {{ deploy.timeout }} # 0
tcp-keepalive {{ deploy.tcp_keep_alive }} # 300

daemonize no
supervised systemd

loglevel {{ deploy.log_level }} # notice
logfile {{ deploy.log_file_path }} # data.log

databases {{ deploy.databases_count }}

always-show-logo no

save 600 1
save 300 10
save 30 100

stop-writes-on-bgsave-error yes

rdbcompression yes
rdbchecksum yes

dbfilename data.rdb

slave-serve-stale-data yes
slave-read-only yes
repl-diskless-sync no
repl-diskless-sync-delay 5
repl-disable-tcp-nodelay no
slave-priority 100

maxclients 5000
maxmemory 1gb
maxmemory-policy noeviction

lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
slave-lazy-flush no

appendonly no
appendfilename "appendonly.aof"
appendfsync everysec

no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
aof-load-truncated yes
aof-use-rdb-preamble no
aof-rewrite-incremental-fsync yes

lua-time-limit 5000

slowlog-log-slower-than 10000
slowlog-max-len 128

latency-monitor-threshold 0
notify-keyspace-events ""

hash-max-ziplist-entries 64
hash-max-ziplist-value 8
list-max-ziplist-size -1
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
hll-sparse-max-bytes 3000

activerehashing yes

client-output-buffer-limit normal 0 0 0
client-output-buffer-limit slave 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

hz 10

activedefrag yes
active-defrag-ignore-bytes 100mb
active-defrag-threshold-lower 10
active-defrag-threshold-upper 100
active-defrag-cycle-min 25
active-defrag-cycle-max 75
